###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         01/Dec/2017  16:31:16 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\Source\ #
#                          SampleApp.c                                        #
#    Command line       =  -f C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\Tools\CC2530DB\f8wCoord.cfg          #
#                          (-DCPU32MHZ -DROOT=__near_func                     #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS) -f       #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\Tools\CC2530DB\f8wConfig.cfg            #
#                          (-DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR      #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFF1                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\Source\ #
#                          SampleApp.c -D ZIGBEEPRO -D ZTOOL_P1 -D xMT_TASK   #
#                          -D xMT_SYS_FUNC -D xMT_ZDO_FUNC -D                 #
#                          LCD_SUPPORTED=DEBUG -lC C:\Users\John\Desktop\Try_ #
#                          zigbee\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\abc\List\ -lA            #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\abc\List\ --diag_suppress Pe001,Pa010 -o         #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\abc\Obj\ -e --debug --core=plain --dptr=16,1     #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\ -I C:\Users\John\Desktop\Try_zigbee\ZStack-C #
#                          C2530-2.3.0-1.4.0\Projects\zstack\Samples\SampleAp #
#                          p\CC2530DB\..\SOURCE\ -I                           #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\ZMAIN\TI2530DB\ -I                      #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\COMPONENTS\MT\ -I                 #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\COMPONENTS\HAL\INCLUDE\ -I        #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\COMPONENTS\HAL\TARGET\CC2530EB\   #
#                          -I C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\OSAL\MCU\CCSOC\ -I  #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\COMPONENTS\OSAL\INCLUDE\ -I       #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\COMPONENTS\STACK\AF\ -I           #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\COMPONENTS\STACK\NWK\ -I          #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\COMPONENTS\STACK\SEC\ -I          #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\COMPONENTS\STACK\SAPI\ -I         #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\COMPONENTS\STACK\SYS\ -I          #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\COMPONENTS\STACK\ZDO\ -I          #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\COMPONENTS\ZMAC\F8W\ -I           #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\COMPONENTS\ZMAC\ -I               #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\COMPONENTS\SERVICES\SADDR\ -I     #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\COMPONENTS\SERVICES\SDATA\ -I     #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\COMPONENTS\MAC\INCLUDE\ -I        #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\COMPONENTS\MAC\HIGH_LEVEL\ -I     #
#                          C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf04\   #
#                          -I C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf04 #
#                          \SINGLE_CHIP\ -Ohz --require_prototypes            #
#    List file          =  C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\abc\List\SampleApp.lst                           #
#    Object file        =  C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3 #
#                          .0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\abc\Obj\SampleApp.r51                            #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\Source\SampleApp.c
      1          /**************************************************************************************************
      2            Filename:       SampleApp.c
      3            Revised:        $Date: 2009-03-18 15:56:27 -0700 (Wed, 18 Mar 2009) $
      4            Revision:       $Revision: 19453 $
      5          
      6            Description:    Sample Application (no Profile).
      7          
      8          
      9            Copyright 2007 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41            This application isn't intended to do anything useful, it is
     42            intended to be a simple example of an application's structure.
     43          
     44            This application sends it's messages either as broadcast or
     45            broadcast filtered group messages.  The other (more normal)
     46            message addressing is unicast.  Most of the other sample
     47            applications are written to support the unicast message model.
     48          
     49            Key control:
     50              SW1:  Sends a flash command to all devices in Group 1.
     51              SW2:  Adds/Removes (toggles) this device in and out
     52                    of Group 1.  This will enable and disable the
     53                    reception of the flash command.
     54          *********************************************************************/
     55          
     56          /*********************************************************************
     57           * INCLUDES
     58           */
     59          #include "OSAL.h"
     60          #include "ZGlobals.h"
     61          #include "AF.h"
     62          #include "aps_groups.h"
     63          #include "ZDApp.h"
     64          
     65          #include "SampleApp.h"
     66          #include "SampleAppHw.h"
     67          
     68          #include "OnBoard.h"
     69          
     70          /* HAL */
     71          #include "hal_lcd.h"
     72          #include "hal_led.h"
     73          #include "hal_key.h"
     74          
     75          /*********************************************************************
     76           * MACROS
     77           */
     78          
     79          /*********************************************************************
     80           * CONSTANTS
     81           */
     82          
     83          /*********************************************************************
     84           * TYPEDEFS
     85           */
     86          
     87          /*********************************************************************
     88           * GLOBAL VARIABLES
     89           */
     90          uint8 LedState = 0;
     91          uint8 SportState = 0;
     92          
     93          // This list should be filled with Application specific Cluster IDs.
     94          const cId_t SampleApp_ClusterList[SAMPLEAPP_MAX_CLUSTERS] =
     95          {
     96            SAMPLEAPP_PERIODIC_CLUSTERID,
                   ^
Error[Pe020]: identifier "SAMPLEAPP_PERIODIC_CLUSTERID" is undefined
     97            SAMPLEAPP_FLASH_CLUSTERID
                   ^
Error[Pe146]: too many initializer values

    SAMPLEAPP_FLASH_CLUSTERID
    ^
"C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\Source\SampleApp.c",97  Error[Pe020]: 
          identifier "SAMPLEAPP_FLASH_CLUSTERID" is undefined
     98          };
     99          
    100          const SimpleDescriptionFormat_t SampleApp_SimpleDesc =
    101          {
    102            SAMPLEAPP_ENDPOINT,              //  int Endpoint;
    103            SAMPLEAPP_PROFID,                //  uint16 AppProfId[2];
    104            SAMPLEAPP_DEVICEID,              //  uint16 AppDeviceId[2];
    105            SAMPLEAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
    106            SAMPLEAPP_FLAGS,                 //  int   AppFlags:4;
    107            SAMPLEAPP_MAX_CLUSTERS,          //  uint8  AppNumInClusters;
    108            (cId_t *)SampleApp_ClusterList,  //  uint8 *pAppInClusterList;
    109            SAMPLEAPP_MAX_CLUSTERS,          //  uint8  AppNumInClusters;
    110            (cId_t *)SampleApp_ClusterList   //  uint8 *pAppInClusterList;
    111          };
    112          
    113          // This is the Endpoint/Interface description.  It is defined here, but
    114          // filled-in in SampleApp_Init().  Another way to go would be to fill
    115          // in the structure here and make it a "const" (in code space).  The
    116          // way it's defined in this sample app it is define in RAM.
    117          endPointDesc_t SampleApp_epDesc;
    118          
    119          /*********************************************************************
    120           * EXTERNAL VARIABLES
    121           */
    122          
    123          /*********************************************************************
    124           * EXTERNAL FUNCTIONS
    125           */
    126          
    127          /*********************************************************************
    128           * LOCAL VARIABLES
    129           */
    130          uint8 SampleApp_TaskID;   // Task ID for internal task/event processing
    131                                    // This variable will be received when
    132                                    // SampleApp_Init() is called.
    133          devStates_t SampleApp_NwkState;
    134          
    135          uint8 SampleApp_TransID;  // This is the unique message ID (counter)
    136          
    137          afAddrType_t SampleApp_Periodic_DstAddr;
    138          afAddrType_t SampleApp_Flash_DstAddr;
    139          
    140          aps_Group_t SampleApp_Group;
    141          
    142          
    143          uint8 SampleAppPeriodicCounter = 0;
    144          uint8 SampleAppFlashCounter = 0;
    145          
    146          //定义方向标志位
    147          uint8 SampleAppDirection = 0;
    148          uint8 SampleAppState = 0;
    149          
    150          /*********************************************************************
    151           * LOCAL FUNCTIONS
    152           */
    153          void SampleApp_HandleKeys( uint8 shift, uint8 keys );
    154          void SampleApp_MessageMSGCB( afIncomingMSGPacket_t *pckt );
    155          void SampleApp_SendPeriodicMessage( void );
    156          void SampleApp_SendFlashMessage( uint16 flashTime );
    157          
    158          /*********************************************************************
    159           * NETWORK LAYER CALLBACKS
    160           */
    161          
    162          /*********************************************************************
    163           * PUBLIC FUNCTIONS
    164           */
    165          
    166          /*********************************************************************
    167           * @fn      SampleApp_Init
    168           *
    169           * @brief   Initialization function for the Generic App Task.
    170           *          This is called during initialization and should contain
    171           *          any application specific initialization (ie. hardware
    172           *          initialization/setup, table initialization, power up
    173           *          notificaiton ... ).
    174           *
    175           * @param   task_id - the ID assigned by OSAL.  This ID should be
    176           *                    used to send messages and set timers.
    177           *
    178           * @return  none
    179           */
    180          void SampleApp_Init( uint8 task_id )
    181          {
    182            SampleApp_TaskID = task_id;
    183            SampleApp_NwkState = DEV_INIT;
    184            SampleApp_TransID = 0;
    185          
    186            P0SEL &= ~0xF2;               //设置P0.6口和P0.7为普通IO
    187            P0DIR |= 0xF2;                //设置P0.6口和P0.7口为输出
    188            
    189          //自行定义IO口模式
    190            
    191            P1SEL &= ~0xD6;               //设置P1.0口为普通IO，设置P1.7口为普通IO，设置P1.6口为普通IO口
    192            P1DIR |= 0xD6;
    193            
    194          //自行定义IO口
    195            
    196            // Device hardware initialization can be added here or in main() (Zmain.c).
    197            // If the hardware is application specific - add it here.
    198            // If the hardware is other parts of the device add it in main().
    199          
    200           #if defined ( BUILD_ALL_DEVICES )
    201            // The "Demo" target is setup to have BUILD_ALL_DEVICES and HOLD_AUTO_START
    202            // We are looking at a jumper (defined in SampleAppHw.c) to be jumpered
    203            // together - if they are - we will start up a coordinator. Otherwise,
    204            // the device will start as a router.
    205            if ( readCoordinatorJumper() )
    206              zgDeviceLogicalType = ZG_DEVICETYPE_COORDINATOR;
    207            else
    208              zgDeviceLogicalType = ZG_DEVICETYPE_ROUTER;
    209          #endif // BUILD_ALL_DEVICES
    210          
    211          #if defined ( HOLD_AUTO_START )
    212            // HOLD_AUTO_START is a compile option that will surpress ZDApp
    213            //  from starting the device and wait for the application to
    214            //  start the device.
    215            ZDOInitDevice(0);
    216          #endif
    217          
    218            // Setup for the periodic message's destination address
    219            // Broadcast to everyone
    220            SampleApp_Periodic_DstAddr.addrMode = (afAddrMode_t)AddrBroadcast;
    221            SampleApp_Periodic_DstAddr.endPoint = SAMPLEAPP_ENDPOINT;
    222            SampleApp_Periodic_DstAddr.addr.shortAddr = 0xFFFF;
    223          
    224            // Setup for the flash command's destination address - Group 1
    225            SampleApp_Flash_DstAddr.addrMode = (afAddrMode_t)afAddrGroup;
    226            SampleApp_Flash_DstAddr.endPoint = SAMPLEAPP_ENDPOINT;
    227            SampleApp_Flash_DstAddr.addr.shortAddr = SAMPLEAPP_FLASH_GROUP; //组号1
                                                            ^
Error[Pe020]: identifier "SAMPLEAPP_FLASH_GROUP" is undefined
    228            
    229            // Fill out the endpoint description.
    230            SampleApp_epDesc.endPoint = SAMPLEAPP_ENDPOINT;
    231            SampleApp_epDesc.task_id = &SampleApp_TaskID;
    232            SampleApp_epDesc.simpleDesc
    233                      = (SimpleDescriptionFormat_t *)&SampleApp_SimpleDesc;
    234            SampleApp_epDesc.latencyReq = noLatencyReqs;
    235          
    236            // Register the endpoint description with the AF
    237            afRegister( &SampleApp_epDesc );
    238          
    239            // Register for all key events - This app will handle all key events
    240            RegisterForKeys( SampleApp_TaskID );
    241          
    242            // By default, all devices start out in Group 1
    243            SampleApp_Group.ID = 0x0001;
    244            osal_memcpy( SampleApp_Group.name, "Group 1", 7 );
    245            aps_AddGroup( SAMPLEAPP_ENDPOINT, &SampleApp_Group );
    246          
    247          #if defined ( LCD_SUPPORTED )
    248            HalLcdWriteString( "SampleApp", HAL_LCD_LINE_1 );
    249          #endif
    250          
    251          //自行定义的事件与处理函数绑定
    252          //  osal_set_event( SampleApp_TaskID, SAMPLEAPP_ZHENG_EVT );
    253          //  osal_set_event( SampleApp_TaskID, SAMPLEAPP_COLOR_EVT );
    254          //自行定义的事件与处理函数绑定
    255            
    256          }
    257          
    258          /*********************************************************************
    259           * @fn      SampleApp_ProcessEvent
    260           *
    261           * @brief   Generic Application Task event processor.  This function
    262           *          is called to process all events for the task.  Events
    263           *          include timers, messages and any other user defined events.
    264           *
    265           * @param   task_id  - The OSAL assigned task ID.
    266           * @param   events - events to process.  This is a bit map and can
    267           *                   contain more than one event.
    268           *
    269           * @return  none
    270           */
    271          uint16 SampleApp_ProcessEvent( uint8 task_id, uint16 events )
    272          {
    273            afIncomingMSGPacket_t *MSGpkt;
    274            (void)task_id;  // Intentionally unreferenced parameter
    275            
    276          //全速运行
    277            
    278          //自行定义的事件处理函数
    279            if ( events & SAMPLEAPP_ZHENG_EVT )
                                 ^
Error[Pe020]: identifier "SAMPLEAPP_ZHENG_EVT" is undefined
    280            {
    281              if( SportState == 1 )
    282              {
    283                if( SampleAppState == 0  )
    284                {
    285                  if( SampleAppDirection == 1 )
    286                  {
    287                    Driver_1 = 0;
                           ^
Error[Pe020]: identifier "Driver_1" is undefined
    288                    Driver_2 = 1;
                           ^
Error[Pe020]: identifier "Driver_2" is undefined
    289                    Driver_3 = 1;
                           ^
Error[Pe020]: identifier "Driver_3" is undefined
    290                    Driver_4 = 0;
                           ^
Error[Pe020]: identifier "Driver_4" is undefined
    291                  }
    292                  if( SampleAppDirection == 2 )
    293                  {
    294                    Driver_1 = 1;
                           ^
Error[Pe020]: identifier "Driver_1" is undefined
    295                    Driver_2 = 0;
                           ^
Error[Pe020]: identifier "Driver_2" is undefined
    296                    Driver_3 = 0;
                           ^
Error[Pe020]: identifier "Driver_3" is undefined
    297                    Driver_4 = 1;
                           ^
Error[Pe020]: identifier "Driver_4" is undefined
    298                  }
    299                  if( SampleAppDirection == 0 )
    300                  {
    301                    Driver_1 = 1;
                           ^
Error[Pe020]: identifier "Driver_1" is undefined
    302                    Driver_2 = 0;
                           ^
Error[Pe020]: identifier "Driver_2" is undefined
    303                    Driver_3 = 1;
                           ^
Error[Pe020]: identifier "Driver_3" is undefined
    304                    Driver_4 = 0;
                           ^
Error[Pe020]: identifier "Driver_4" is undefined
    305                  }
    306                  SampleAppState = 1;
    307                  osal_start_timerEx( SampleApp_TaskID, SAMPLEAPP_ZHENG_EVT, 5 );
    308                }
    309                else if( SampleAppState == 1 )
    310                {
    311                  Driver_1 = 0;
                         ^
Error[Pe020]: identifier "Driver_1" is undefined
    312                  Driver_2 = 0;
                         ^
Error[Pe020]: identifier "Driver_2" is undefined
    313                  Driver_3 = 0;
                         ^
Error[Pe020]: identifier "Driver_3" is undefined
    314                  Driver_4 = 0;
                         ^
Error[Pe020]: identifier "Driver_4" is undefined
    315                  SampleAppState = 0;
    316                  osal_start_timerEx( SampleApp_TaskID, SAMPLEAPP_ZHENG_EVT, 15 );
    317                }
    318              }
    319              else if( SportState == 0 )
    320              {
    321                  Driver_1 = 0;
                         ^
Error[Pe020]: identifier "Driver_1" is undefined
    322                  Driver_2 = 0;
                         ^
Error[Pe020]: identifier "Driver_2" is undefined
    323                  Driver_3 = 0;
                         ^
Error[Pe020]: identifier "Driver_3" is undefined
    324                  Driver_4 = 0;
                         ^
Error[Pe020]: identifier "Driver_4" is undefined
    325              }
    326            
    327              return( events ^ SAMPLEAPP_ZHENG_EVT );
    328            }
    329          //自行定义的事件处理函数
    330            
    331            if( events & SAMPLEAPP_COLOR_EVT ) //此时检测到黑带
    332            {
    333              if( SportState == 1 )
    334              {
    335                if( Color_1 == 1 && Color_2 == 0 )
                           ^
Error[Pe020]: identifier "Color_1" is undefined

        if( Color_1 == 1 && Color_2 == 0 )
                            ^
"C:\Users\John\Desktop\Try_zigbee\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\Source\SampleApp.c",335  Error[Pe020]: 
          identifier "Color_2" is undefined
    336                {
    337                  SampleAppDirection = 1;
    338                  osal_start_timerEx( SampleApp_TaskID, SAMPLEAPP_COLOR_EVT, 100 );
    339                }
    340                else if( Color_1 == 0 && Color_2 == 1 )   
    341                {
    342                  SampleAppDirection = 2;
    343                  osal_start_timerEx( SampleApp_TaskID, SAMPLEAPP_COLOR_EVT, 100 );
    344                }
    345                else if( Color_1 == 0 && Color_2 == 0 )
    346                {
    347                  SampleAppDirection = 0;
    348                  osal_start_timerEx( SampleApp_TaskID, SAMPLEAPP_COLOR_EVT, 50 );
    349                }    
    350                else if( Color_1 == 1 && Color_2 == 1 )
    351                {
    352                  osal_start_timerEx( SampleApp_TaskID, SAMPLEAPP_COLOR_EVT, 50 );
    353                }
    354              }
    355              
    356              return( events ^ SAMPLEAPP_COLOR_EVT );
    357            }
    358          
    359              
    360            if ( events & SYS_EVENT_MSG )
    361            {
    362              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( SampleApp_TaskID );
    363              while ( MSGpkt )
    364              {
    365                switch ( MSGpkt->hdr.event )
    366                {
    367                  // Received when a key is pressed
    368                  case KEY_CHANGE:
    369                    SampleApp_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    370                    break;
    371          
    372                  // Received when a messages is received (OTA) for this endpoint
    373                  case AF_INCOMING_MSG_CMD:
    374                    SampleApp_MessageMSGCB( MSGpkt );
    375                    break;
    376          
    377                  // Received whenever the device changes state in the network
    378                  case ZDO_STATE_CHANGE:
    379                    SampleApp_NwkState = (devStates_t)(MSGpkt->hdr.status);
    380                    if ( (SampleApp_NwkState == DEV_ZB_COORD) ||
    381                           (SampleApp_NwkState == DEV_ROUTER)
    382                        || (SampleApp_NwkState == DEV_END_DEVICE) )
    383                    {
    384                      // Start sending the periodic message in a regular interval.
    385                      //osal_start_timerEx( SampleApp_TaskID,
    386                      //                  SAMPLEAPP_SEND_PERIODIC_MSG_EVT,
    387                      //                  SAMPLEAPP_SEND_PERIODIC_MSG_TIMEOUT );
    388                    }
    389                    else
    390                    {
    391                      // Device is no longer in the network
    392                    }
    393                    break;
    394          
    395                  default:
    396                    break;
    397                }
    398          
    399                // Release the memory
    400                osal_msg_deallocate( (uint8 *)MSGpkt );
    401          
    402                // Next - if one is available
    403                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( SampleApp_TaskID );
    404              }
    405          
    406              // return unprocessed events
    407              return (events ^ SYS_EVENT_MSG);
    408            }
    409          
    410            // Send a message out - This event is generated by a timer
    411            //  (setup in SampleApp_Init()).
    412            if ( events & SAMPLEAPP_SEND_PERIODIC_MSG_EVT )
                                 ^
Error[Pe020]: identifier "SAMPLEAPP_SEND_PERIODIC_MSG_EVT" is undefined
    413            {
    414              // Send the periodic message
    415              SampleApp_SendPeriodicMessage();
    416          
    417              // Setup to send message again in normal period (+ a little jitter)
    418              osal_start_timerEx( SampleApp_TaskID, SAMPLEAPP_SEND_PERIODIC_MSG_EVT,
    419                  (SAMPLEAPP_SEND_PERIODIC_MSG_TIMEOUT + (osal_rand() & 0x00FF)) );
                          ^
Error[Pe020]: identifier "SAMPLEAPP_SEND_PERIODIC_MSG_TIMEOUT" is undefined
    420          
    421              // return unprocessed events
    422              return (events ^ SAMPLEAPP_SEND_PERIODIC_MSG_EVT);
    423            }
    424          
    425            // Discard unknown events
    426            return 0;
    427          }
    428          
    429          /*********************************************************************
    430           * Event Generation Functions
    431           */
    432          /*********************************************************************
    433           * @fn      SampleApp_HandleKeys
    434           *
    435           * @brief   Handles all key events for this device.
    436           *
    437           * @param   shift - true if in shift/alt.
    438           * @param   keys - bit field for key events. Valid entries:
    439           *                 HAL_KEY_SW_2
    440           *                 HAL_KEY_SW_1
    441           *
    442           * @return  none
    443           */
    444          void SampleApp_HandleKeys( uint8 shift, uint8 keys )
    445          {
    446            (void)shift;  // Intentionally unreferenced parameter
    447            
    448            if ( keys & HAL_KEY_SW_6 )
    449            {
    450              #if defined(ZDO_COORDINATOR)       //协调器只接收数据
    451                SampleApp_SendPeriodicMessage(); //以组播方式发数据    
    452              #else                              //路由器和终端才发送数据
    453          
    454              #endif
    455            }
    456          
    457            if ( keys & HAL_KEY_SW_1 )
    458            {
    459              /* The Flashr Command is sent to Group 1.
    460               * This key toggles this device in and out of group 1.
    461               * If this device doesn't belong to group 1, this application
    462               * will not receive the Flash command sent to group 1.
    463               */
    464              aps_Group_t *grp;
    465              grp = aps_FindGroup( SAMPLEAPP_ENDPOINT, SAMPLEAPP_FLASH_GROUP );
                                                              ^
Error[Pe020]: identifier "SAMPLEAPP_FLASH_GROUP" is undefined
    466              if ( grp )
    467              {
    468                // Remove from the group
    469                aps_RemoveGroup( SAMPLEAPP_ENDPOINT, SAMPLEAPP_FLASH_GROUP );
    470              }
    471              else
    472              {
    473                // Add to the flash group
    474                aps_AddGroup( SAMPLEAPP_ENDPOINT, &SampleApp_Group );
    475              }
    476            }
    477          }
    478          
    479          /*********************************************************************
    480           * LOCAL FUNCTIONS
    481           */
    482          
    483          /*********************************************************************
    484           * @fn      SampleApp_MessageMSGCB
    485           *
    486           * @brief   Data message processor callback.  This function processes
    487           *          any incoming data - probably from other devices.  So, based
    488           *          on cluster ID, perform the intended action.
    489           *
    490           * @param   none
    491           *
    492           * @return  none
    493           */
    494          void SampleApp_MessageMSGCB( afIncomingMSGPacket_t *pkt )
    495          {
    496            uint8 data;
    497          
    498            switch ( pkt->clusterId )
    499            {    
    500              case SAMPLEAPP_PERIODIC_CLUSTERID:       
    501                  data = (uint8)pkt->cmd.Data[0];
    502                  SportState = data;
    503                  if(data == 0) 
    504                  {
    505                    HalLedSet(HAL_LED_1, HAL_LED_MODE_OFF);  
    506                  }
    507                  else
    508                  {
    509                    osal_set_event( SampleApp_TaskID, SAMPLEAPP_ZHENG_EVT );
                                                             ^
Error[Pe020]: identifier "SAMPLEAPP_ZHENG_EVT" is undefined
    510                    osal_set_event( SampleApp_TaskID, SAMPLEAPP_COLOR_EVT );
    511                    HalLedSet(HAL_LED_1, HAL_LED_MODE_ON); 
    512                  }
    513                  break;
    514          
    515              case SAMPLEAPP_FLASH_CLUSTERID:
    516          
    517                  break;
    518            }
    519          }
    520          
    521          /*********************************************************************
    522           * @fn      SampleApp_SendPeriodicMessage
    523           *
    524           * @brief   Send the periodic message.
    525           *
    526           * @param   none
    527           *
    528           * @return  none
    529           */
    530          void SampleApp_SendPeriodicMessage( void )
    531          {
    532            if( LedState == 0 )
    533              LedState = 1;
    534            else if( LedState == 1 )
    535              LedState = 0;
    536            
    537            if ( AF_DataRequest( &SampleApp_Periodic_DstAddr, &SampleApp_epDesc,
    538                                 SAMPLEAPP_PERIODIC_CLUSTERID,
    539                                 1,
    540                                 &LedState,
    541                                 &SampleApp_TransID,
    542                                 AF_DISCV_ROUTE,
    543                                 AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
    544            {
    545              if(LedState == 0 )
    546                HalLedSet(HAL_LED_1, HAL_LED_MODE_ON);  
    547              else if( LedState == 1 )
    548                HalLedSet(HAL_LED_1, HAL_LED_MODE_OFF); 
    549            }
    550            else
    551            {
    552              // Error occurred in request to send.
    553            }
    554          }
    555          
    556          /*********************************************************************
    557           * @fn      SampleApp_SendFlashMessage
    558           *
    559           * @brief   Send the flash message to group 1.
    560           *
    561           * @param   flashTime - in milliseconds
    562           *
    563           * @return  none
    564           */
    565          void SampleApp_SendFlashMessage( uint16 flashTime )
    566          {
    567            uint8 buffer[3];
    568            buffer[0] = (uint8)(SampleAppFlashCounter++);
    569            buffer[1] = LO_UINT16( flashTime );
    570            buffer[2] = HI_UINT16( flashTime );
    571          
    572            if ( AF_DataRequest( &SampleApp_Flash_DstAddr, &SampleApp_epDesc,
    573                                 SAMPLEAPP_FLASH_CLUSTERID,
    574                                 3,
    575                                 buffer,
    576                                 &SampleApp_TransID,
    577                                 AF_DISCV_ROUTE,
    578                                 AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
    579            {
    580            }
    581            else
    582            {
    583              // Error occurred in request to send.
    584            }
    585          }
    586          
    587          /*********************************************************************
    588          *********************************************************************/

Errors: 31
Warnings: none
